{"version":3,"file":"index.js","sources":["../../../src/components/feature-flags/index.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2025, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n/**\n * <feature-flags> provides scoped feature flags to child components.\n *\n * Usage:\n * Wrap any child components inside <feature-flags> to provide scoped feature flags like this:\n * <feature-flags enable-dialog-element=\"true\">\n *   <component></component>\n * </feature-flags>\n *\n * Available flags:\n * - enable-dialog-element\n * - enable-treeview-controllable\n * - ... (and others listed in observedAttributes)\n *\n * How to check a Flag in your component:\n *   import { isFeatureFlagEnabled } from './feature-flags';\n *   isFeatureFlagEnabled('enable-dialog-element', this)\n *   Returns true if the flag is enabled in the nearest <feature-flags> ancestor\n */\n\nimport {\n  FeatureFlags as GlobalFeatureFlags,\n  createScope,\n} from '@carbon/feature-flags';\nimport { carbonElement as customElement } from '../../globals/decorators/carbon-element';\nimport { LitElement, html } from 'lit';\n\n/**\n * Feature Flags\n *\n * @element feature-flags\n */\n\ntype FeatureFlags = Record<string, boolean>;\n\n@customElement('feature-flags')\nclass FeatureFlagsElement extends LitElement {\n  private scope = GlobalFeatureFlags;\n  private flags: FeatureFlags = {};\n\n  /**\n   * Mapping of feature flag attributes to their related component names.\n   */\n  private static readonly flagComponentMap: Record<string, string> = {\n    'enable-v12-tile-default-icons': 'CDS-TILE',\n    'enable-v12-tile-radio-icons': 'CDS-TILE',\n    'enable-v12-overflowmenu': 'CDS-OVERFLOW-MENU',\n    'enable-treeview-controllable': 'CDS-TREEVIEW',\n    'enable-experimental-focus-wrap-without-sentinels': 'CDS-FOCUS-WRAP',\n    'enable-focus-wrap-without-sentinels': 'CDS-FOCUS-WRAP',\n    'enable-dialog-element': 'CDS-DIALOG',\n    'enable-v12-dynamic-floating-styles': 'CDS-FLOATING',\n    'enable-v12-toggle-reduced-label-spacing': 'CDS-TOGGLE',\n  };\n\n  static get observedAttributes() {\n    return Object.keys(FeatureFlagsElement.flagComponentMap);\n  }\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.updateScope();\n  }\n\n  attributeChangedCallback(\n    name: string,\n    _oldVal: string | null,\n    newVal: string | null\n  ) {\n    const value = newVal === 'true';\n    this.flags[name] = value;\n\n    // Set feature flag to top component level\n    const relatedComponent =\n      FeatureFlagsElement.flagComponentMap[name] || 'unknown';\n    if (this.firstElementChild?.tagName === relatedComponent) {\n      this.firstElementChild.setAttribute(name, '');\n    }\n\n    this.updateScope();\n  }\n\n  private getParentScope(): FeatureFlagsElement | null {\n    let parent = this.parentNode;\n    while (parent) {\n      if (parent instanceof FeatureFlagsElement) {\n        return parent.getScope();\n      }\n      parent = parent.parentNode;\n    }\n    return null;\n  }\n\n  private updateScope() {\n    const newScope = createScope(this.flags);\n    const parentScope = this.getParentScope() || GlobalFeatureFlags;\n    if (parentScope) {\n      newScope.mergeWithScope(parentScope);\n    }\n    this.scope = newScope;\n  }\n\n  render() {\n    return html` <slot></slot> `;\n  }\n\n  public isFeatureFlagEnabled(flag: string): boolean {\n    return this.scope.enabled(flag);\n  }\n\n  private getScope() {\n    return this.scope;\n  }\n}\n\nexport default FeatureFlagsElement;\n\n// Utility functions\n\n// Function to find the nearest parent FeatureFlagsElement\nexport function findParentFeatureFlags(\n  el: HTMLElement\n): FeatureFlagsElement | null {\n  let parent = el.parentNode;\n  while (parent) {\n    if (parent instanceof FeatureFlagsElement) {\n      return parent;\n    }\n    parent = (parent as HTMLElement).parentNode;\n  }\n  return null;\n}\n\n// function to check if a feature flag is enabled in components\nexport function isFeatureFlagEnabled(\n  flag: string,\n  context: HTMLElement\n): boolean {\n  const instance = findParentFeatureFlags(context);\n  return instance?.isFeatureFlagEnabled(flag) ?? false;\n}\n"],"names":["GlobalFeatureFlags","customElement"],"mappings":"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"}