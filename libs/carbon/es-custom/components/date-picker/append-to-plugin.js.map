{"version":3,"file":"append-to-plugin.js","sources":["../../../src/components/date-picker/append-to-plugin.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2019, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { Instance as FlatpickrInstance } from 'flatpickr/dist/types/instance';\nimport { Plugin } from 'flatpickr/dist/types/options';\n\n/**\n * The configuration for the Flatpickr plugin to put the calendar dropdown in shadow DOM.\n */\nexport interface DatePickerAppendToPluginConfig {\n  /**\n   * The floating menu container.\n   */\n  appendTo: HTMLElement;\n}\n\n/**\n * @param config Plugin configuration.\n * @returns A Flatpickr plugin to put the calendar dropdown in shadow DOM.\n */\nexport default (config: DatePickerAppendToPluginConfig): Plugin =>\n  (fp: FlatpickrInstance) => {\n    /**\n     * Adjusts the floating meun position after Flatpicker sets it.\n     */\n    const handlePreCalendarPosition = async () => {\n      await Promise.resolve();\n      const {\n        calendarContainer,\n        config: fpConfig,\n        _positionElement: positionElement,\n      } = fp;\n      const { appendTo } = fpConfig;\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- https://github.com/carbon-design-system/carbon/issues/20452\n      const { top: containerTop } = appendTo!.getBoundingClientRect();\n      const { bottom: refBottom } = positionElement.getBoundingClientRect();\n      const isRtl =\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- https://github.com/carbon-design-system/carbon/issues/20452\n        appendTo!\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- https://github.com/carbon-design-system/carbon/issues/20452\n          .ownerDocument!.defaultView!.getComputedStyle(appendTo!)\n          .getPropertyValue('direction') === 'rtl';\n      calendarContainer.style.top = `${refBottom - containerTop}px`;\n      calendarContainer.style.left = !isRtl ? '0' : 'auto';\n      calendarContainer.style.right = !isRtl ? 'auto' : '0';\n    };\n\n    /**\n     * Registers this Flatpickr plugin.\n     *\n     */\n    const register = () => {\n      fp.loadedPlugins.push('carbonFlatpickrAppendToPlugin');\n    };\n\n    return {\n      appendTo: config.appendTo,\n      onReady: register,\n      onPreCalendarPosition: handlePreCalendarPosition,\n    };\n  };\n"],"names":[],"mappings":";;;;;;;AAAA;;;;;AAKG;AAeH;;;AAGG;AACH,qBAAe,CAAC,MAAsC,KACpD,CAAC,EAAqB,KAAI;AACxB;;AAEG;AACH,IAAA,MAAM,yBAAyB,GAAG,YAAW;AAC3C,QAAA,MAAM,OAAO,CAAC,OAAO,EAAE;AACvB,QAAA,MAAM,EACJ,iBAAiB,EACjB,MAAM,EAAE,QAAQ,EAChB,gBAAgB,EAAE,eAAe,GAClC,GAAG,EAAE;AACN,QAAA,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ;;QAE7B,MAAM,EAAE,GAAG,EAAE,YAAY,EAAE,GAAG,QAAS,CAAC,qBAAqB,EAAE;QAC/D,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,eAAe,CAAC,qBAAqB,EAAE;AACrE,QAAA,MAAM,KAAK;;QAET;;AAEG,aAAA,aAAc,CAAC,WAAY,CAAC,gBAAgB,CAAC,QAAS;AACtD,aAAA,gBAAgB,CAAC,WAAW,CAAC,KAAK,KAAK;QAC5C,iBAAiB,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,SAAS,GAAG,YAAY,CAAA,EAAA,CAAI;AAC7D,QAAA,iBAAiB,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,KAAK,GAAG,GAAG,GAAG,MAAM;AACpD,QAAA,iBAAiB,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,KAAK,GAAG,MAAM,GAAG,GAAG;AACvD,KAAC;AAED;;;AAGG;IACH,MAAM,QAAQ,GAAG,MAAK;AACpB,QAAA,EAAE,CAAC,aAAa,CAAC,IAAI,CAAC,+BAA+B,CAAC;AACxD,KAAC;IAED,OAAO;QACL,QAAQ,EAAE,MAAM,CAAC,QAAQ;AACzB,QAAA,OAAO,EAAE,QAAQ;AACjB,QAAA,qBAAqB,EAAE,yBAAyB;KACjD;AACH,CAAC;;;;"}