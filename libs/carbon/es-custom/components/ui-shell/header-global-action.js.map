{"version":3,"file":"header-global-action.js","sources":["../../../src/components/ui-shell/header-global-action.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2023, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { LitElement } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { carbonElement as customElement } from '../../globals/decorators/carbon-element';\nimport {\n  BUTTON_TOOLTIP_POSITION,\n  BUTTON_KIND,\n  BUTTON_SIZE,\n} from '../button/button';\nimport CDSButton from '../button/button';\nimport HostListener from '../../globals/decorators/host-listener';\nimport styles from './header.scss?lit';\nimport { prefix } from '../../globals/settings';\n\n/**\n * Header global action button\n *\n * @element cds-custom-header-global-action\n */\n@customElement(`${prefix}-header-global-action`)\nclass CDSHeaderGlobalAction extends CDSButton {\n  @query('button')\n  protected _buttonNode!: HTMLButtonElement;\n\n  /**\n   * Specify whether the action is currently active\n   */\n  @property({ type: Boolean, reflect: true })\n  active;\n\n  /**\n   * Specify which header panel the button is associated with.\n   */\n  @property({ type: String, attribute: 'panel-id', reflect: true })\n  panelId;\n\n  /**\n   * The `aria-label` attribute for the button in its active state.\n   */\n  @property({ attribute: 'button-label-active' })\n  buttonLabelActive;\n\n  /**\n   * The `aria-label` attribute for the button in its inactive state.\n   */\n  @property({ attribute: 'button-label-inactive' })\n  buttonLabelInactive;\n\n  connectedCallback() {\n    this.tooltipPosition = BUTTON_TOOLTIP_POSITION.BOTTOM;\n    this.kind = BUTTON_KIND.GHOST;\n    this.size = BUTTON_SIZE.LARGE;\n    super.connectedCallback();\n  }\n\n  firstUpdated() {\n    document.addEventListener('click', this._handleDocumentClick, true);\n    document.addEventListener('focusin', this._handleDocumentFocusIn, true);\n  }\n\n  disconnectedCallback() {\n    document.removeEventListener('click', this._handleDocumentClick, true);\n    document.removeEventListener('focusin', this._handleDocumentFocusIn, true);\n    super.disconnectedCallback();\n  }\n\n  private _handleDocumentClick = (event: MouseEvent) => {\n    const path = event.composedPath();\n    this._handlePanelCloseIfFocusOutside(path);\n  };\n\n  private _handleDocumentFocusIn = (event: FocusEvent) => {\n    const path = event.composedPath();\n    this._handlePanelCloseIfFocusOutside(path);\n  };\n\n  private _handlePanelCloseIfFocusOutside(path: EventTarget[]) {\n    const panel = this.ownerDocument?.querySelector(`#${this.panelId}`);\n    const isInside = path.some(\n      (el) =>\n        el instanceof HTMLElement && (panel?.contains(el) || this.contains(el))\n    );\n\n    if (panel && !isInside) {\n      panel.removeAttribute('expanded');\n      this.active = false;\n    }\n  }\n\n  @HostListener('focusout')\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment -- https://github.com/carbon-design-system/carbon/issues/20452\n  // @ts-ignore\n  private _handleFocusOut(event: FocusEvent) {\n    const panel = this.ownerDocument?.querySelector(`#${this.panelId}`);\n    const relatedTarget = event.relatedTarget as HTMLElement;\n\n    if (\n      panel &&\n      relatedTarget &&\n      !this.contains(relatedTarget) &&\n      !panel.contains(relatedTarget)\n    ) {\n      panel.removeAttribute('expanded');\n      this.active = false;\n    }\n  }\n\n  @HostListener('click', { capture: true })\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment -- https://github.com/carbon-design-system/carbon/issues/20452\n  // @ts-ignore\n  private _handleClick(event: Event) {\n    const { disabled } = this;\n    if (disabled) {\n      event.stopPropagation();\n    } else {\n      const panel = this.ownerDocument?.querySelector(`#${this.panelId}`);\n\n      // see if there is related panel for header-global-action button first\n      // and then set the expanded attr of it accordingly\n      if (panel) {\n        const expanded = panel.getAttribute('expanded');\n\n        if (expanded) {\n          panel.removeAttribute('expanded');\n        } else {\n          panel.setAttribute('expanded', 'true');\n        }\n\n        const active = !this.active;\n        this.active = active;\n      }\n    }\n  }\n\n  @HostListener('keydown', { capture: true })\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment -- https://github.com/carbon-design-system/carbon/issues/20452\n  // @ts-ignore\n  private _handleKeyDown(event: KeyboardEvent) {\n    const { key } = event;\n    if (key === 'Enter' || key === ' ') {\n      event.preventDefault();\n      this._handleClick(event);\n    } else if (key === 'Escape') {\n      const panel = this.ownerDocument?.querySelector(`#${this.panelId}`);\n      if (panel) {\n        panel.removeAttribute('expanded');\n      }\n      this.active = false;\n    }\n  }\n\n  updated() {\n    if (this._buttonNode) {\n      this._buttonNode.classList.add(`${prefix}--header__action`);\n    }\n  }\n\n  shouldUpdate(changedProperties) {\n    if (changedProperties.has('active')) {\n      if (this.active) {\n        this._buttonNode.classList.add(`${prefix}--header__action--active`);\n\n        if (this.buttonLabelActive) {\n          this.tooltipText = this.buttonLabelActive;\n        }\n      } else {\n        this._buttonNode.classList.remove(`${prefix}--header__action--active`);\n\n        if (this.buttonLabelInactive) {\n          this.tooltipText = this.buttonLabelInactive;\n        }\n      }\n    }\n    return true;\n  }\n\n  static shadowRootOptions = {\n    ...LitElement.shadowRootOptions,\n    delegatesFocus: true,\n  };\n\n  static styles = styles;\n}\n\nexport default CDSHeaderGlobalAction;\n"],"names":["customElement"],"mappings":"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"}