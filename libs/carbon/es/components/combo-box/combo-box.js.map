{"version":3,"file":"combo-box.js","sources":["../../../src/components/combo-box/combo-box.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2019, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { classMap } from 'lit/directives/class-map.js';\nimport { TemplateResult, html } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { prefix } from '../../globals/settings';\nimport Close16 from '@carbon/icons/es/close/16.js';\nimport { forEach } from '../../globals/internal/collection-helpers';\nimport CDSDropdown, { DROPDOWN_KEYBOARD_ACTION } from '../dropdown/dropdown';\nimport CDSComboBoxItem from './combo-box-item';\nimport { iconLoader } from '../../globals/internal/icon-loader';\nimport styles from './combo-box.scss?lit';\nimport { carbonElement as customElement } from '../../globals/decorators/carbon-element';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport ifNonEmpty from '../../globals/directives/if-non-empty';\n\nexport { DROPDOWN_DIRECTION, DROPDOWN_SIZE } from '../dropdown/dropdown';\n\ntype ShouldFilterItem = (input: {\n  item: CDSComboBoxItem;\n  itemToString: (item: CDSComboBoxItem) => string;\n  inputValue: string | null;\n}) => boolean;\n\n/**\n * Combo box.\n *\n * @element cds-combo-box\n * @fires cds-combo-box-beingselected\n *   The custom event fired before a combo box item is selected upon a user gesture.\n *   Cancellation of this event stops changing the user-initiated selection.\n * @fires cds-combo-box-beingtoggled\n *   The custom event fired before the open state of this combo box is toggled upon a user gesture.\n *   Cancellation of this event stops the user-initiated toggling.\n * @fires cds-combo-box-selected - The custom event fired after a combo box item is selected upon a user gesture.\n * @fires cds-combo-box-toggled - The custom event fired after the open state of this combo box is toggled upon a user gesture.\n */\n@customElement(`${prefix}-combo-box`)\nclass CDSComboBox extends CDSDropdown {\n  /**\n   * The text content that should be set to the `<input>` for filtering.\n   */\n  protected _filterInputValue = '';\n\n  protected _shouldTriggerBeFocusable = false;\n\n  /**\n   * The `<input>` for filtering.\n   */\n  @query('input')\n  private _filterInputNode!: HTMLInputElement;\n\n  /**\n   * The menu containing all selectable items.\n   */\n  @query('#menu-body')\n  private _itemMenu!: HTMLElement;\n\n  /**\n   * The selection button.\n   */\n  @query('#selection-button')\n  private _selectionButtonNode!: HTMLElement;\n\n  /**\n   * @param item A combo box item.\n   * @returns `true` if the given combo box item matches the query text user types.\n   */\n  protected _testItemWithQueryText(item) {\n    return (this.itemMatches || this._defaultItemMatches)(\n      item,\n      this._filterInputNode.value\n    );\n  }\n\n  /**\n   * The default item matching callback.\n   *\n   * @param item The combo box item.\n   * @param queryText The query text user types.\n   * @returns `true` if the given combo box item matches the given query text.\n   */\n  protected _defaultItemMatches(\n    item: CDSComboBoxItem,\n    queryText: string\n  ): boolean {\n    return (\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- https://github.com/carbon-design-system/carbon/issues/20452\n      item.textContent!.toLowerCase().indexOf(queryText.toLowerCase()) >= 0\n    );\n  }\n\n  /**\n   * Handles `input` event on the `<input>` for filtering.\n   */\n  protected _handleInput() {\n    const rawQueryText = this._filterInputNode.value;\n    const queryText = rawQueryText.trim().toLowerCase();\n\n    if (rawQueryText.length !== 0) {\n      this.setAttribute('isClosable', '');\n    } else {\n      this.removeAttribute('isClosable');\n    }\n\n    const items = this.querySelectorAll(\n      (this.constructor as typeof CDSComboBox).selectorItem\n    );\n\n    const firstMatchIndex = this._filterItems(items, queryText, rawQueryText);\n    if (firstMatchIndex !== -1) {\n      const highlightedItem = items[firstMatchIndex];\n      if (highlightedItem) {\n        this._scrollItemIntoView(highlightedItem as HTMLElement);\n      }\n    }\n\n    this._filterInputValue = rawQueryText;\n    this.open = true;\n    this.requestUpdate();\n  }\n\n  // Applies filtering/highlighting to all slotted items.\n  protected _filterItems(\n    items: NodeListOf<Element>,\n    queryText: string,\n    rawQueryText: string\n  ): number {\n    let firstMatchIndex = -1;\n    const hasQuery = Boolean(queryText);\n    forEach(items, (item, i) => {\n      const comboItem = item as CDSComboBoxItem;\n      const index = i ?? -1;\n      if (!hasQuery) {\n        (comboItem as HTMLElement).style.display = '';\n        comboItem.highlighted = false;\n        return;\n      }\n      const matches = (comboItem.textContent || '')\n        .toLowerCase()\n        .includes(queryText);\n      const filterFunction =\n        typeof this.shouldFilterItem === 'function'\n          ? this.shouldFilterItem\n          : null;\n      const shouldApplyBuiltInFilter =\n        filterFunction === null && hasQuery && this.shouldFilterItem === true;\n      const itemToString = (value: CDSComboBoxItem) => value.textContent || '';\n      const filterInputValue = rawQueryText.length === 0 ? null : rawQueryText;\n      const passesFilter = filterFunction\n        ? filterFunction({\n            item: comboItem,\n            itemToString,\n            inputValue: filterInputValue,\n          })\n        : shouldApplyBuiltInFilter\n          ? matches\n          : true;\n      const highlightMatch = filterFunction !== null ? passesFilter : matches;\n      if (highlightMatch && firstMatchIndex === -1) {\n        firstMatchIndex = index;\n      }\n      if (filterFunction || shouldApplyBuiltInFilter) {\n        (comboItem as HTMLElement).style.display = passesFilter ? '' : 'none';\n      } else {\n        (comboItem as HTMLElement).style.display = '';\n      }\n      comboItem.highlighted = index === firstMatchIndex;\n    });\n    return firstMatchIndex;\n  }\n\n  protected _scrollItemIntoView(item: HTMLElement) {\n    if (!this._itemMenu) {\n      return;\n    }\n    const menuRect = this._itemMenu.getBoundingClientRect();\n    const itemRect = item.getBoundingClientRect();\n    if (!menuRect || !itemRect) {\n      return;\n    }\n    const menuBottom = menuRect.top + this._itemMenu.clientHeight;\n    const isWithinViewport =\n      menuRect.top <= itemRect.top && itemRect.bottom <= menuBottom;\n    if (isWithinViewport) {\n      return;\n    }\n    const scrollTop = itemRect.top - menuRect.top;\n    const scrollBottom = itemRect.bottom - menuRect.bottom;\n    this._itemMenu.scrollTop +=\n      Math.abs(scrollTop) < Math.abs(scrollBottom) ? scrollTop : scrollBottom;\n  }\n\n  protected _getSelectedItem(): CDSComboBoxItem | null {\n    if (!this.value) return null;\n    const items = Array.from(\n      this.querySelectorAll(\n        (this.constructor as typeof CDSDropdown).selectorItem\n      )\n    ) as CDSComboBoxItem[];\n    return items.find((it) => String(it.value) === String(this.value)) ?? null;\n  }\n\n  protected _revertInputToSelected(focus = true) {\n    const selected = this._getSelectedItem();\n    const text = selected?.textContent ?? '';\n\n    this._filterInputValue = text;\n\n    if (this._filterInputNode) {\n      this._filterInputNode.value = text;\n\n      if (focus) {\n        try {\n          this._filterInputNode.focus();\n          const len = text.length;\n          this._filterInputNode.setSelectionRange(len, len);\n        } catch {\n          /* ignore */\n        }\n      }\n    }\n\n    this._resetFilteredItems();\n    this.removeAttribute('isClosable');\n    this.requestUpdate();\n  }\n\n  protected _handleInputKeydown(event: KeyboardEvent) {\n    if (event.key !== 'Escape') {\n      return;\n    }\n    if (!this._filterInputNode) {\n      return;\n    }\n\n    if (this.value) {\n      this._revertInputToSelected(true);\n    } else if (this._filterInputNode.value) {\n      this._clearInputWithoutSelecting(true);\n    }\n  }\n\n  protected _handleClickInner(event: MouseEvent) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any -- https://github.com/carbon-design-system/carbon/issues/20452\n    const { target } = event as any;\n    if (this._selectionButtonNode?.contains(target)) {\n      this._handleUserInitiatedClearInput();\n    } else {\n      super._handleClickInner(event);\n    }\n  }\n\n  protected _handleKeypressInner(event: KeyboardEvent) {\n    const { key } = event;\n    const action = (this.constructor as typeof CDSDropdown).getAction(key);\n    const { TRIGGERING } = DROPDOWN_KEYBOARD_ACTION;\n    if (\n      this._selectionButtonNode?.contains(event.target as Node) &&\n      // Space key should be handled by `<input>` unless \"clear selection\" button has focus\n      (action === TRIGGERING || key === ' ')\n    ) {\n      this._handleUserInitiatedClearInput();\n    } else {\n      super._handleKeypressInner(event);\n    }\n  }\n\n  /**\n   * Handles user-initiated clearing the `<input>` for filtering.\n   */\n  protected _handleUserInitiatedClearInput() {\n    this._resetFilteredItems();\n    this._filterInputValue = '';\n    if (this._filterInputNode) {\n      this._filterInputNode.value = '';\n      this._filterInputNode.focus();\n    }\n\n    this._handleUserInitiatedSelectItem();\n    this.requestUpdate();\n  }\n\n  protected _handleUserInitiatedSelectItem(item?: CDSComboBoxItem) {\n    if (item && !this._selectionShouldChange(item)) {\n      // Escape hatch for `shouldUpdate()` logic that updates `._filterInputValue()` when selection changes,\n      // given we want to update the `<input>` and close the dropdown even if selection doesn't update.\n      // Use case:\n      // 1. Select the 2nd item in combo box drop down\n      // 2. Type some text in the `<input>`\n      // 3. Re-select the 2nd item in combo box drop down,\n      //    the `<input>` has to updated with the 2nd item and the dropdown should be closed,\n      //    even if there is no change in the selected value\n      this._filterInputValue = item.textContent || '';\n      this.open = false;\n      this.requestUpdate();\n    }\n    super._handleUserInitiatedSelectItem(item);\n  }\n\n  protected _selectionDidChange(itemToSelect?: CDSComboBoxItem) {\n    this.value = !itemToSelect ? '' : itemToSelect.value;\n    forEach(\n      this.querySelectorAll(\n        (this.constructor as typeof CDSDropdown).selectorItemSelected\n      ),\n      (item) => {\n        (item as CDSComboBoxItem).selected = false;\n        item.setAttribute('aria-selected', 'false');\n      }\n    );\n    if (itemToSelect) {\n      itemToSelect.selected = true;\n      itemToSelect.setAttribute('aria-selected', 'true');\n    }\n\n    this._handleUserInitiatedToggle(false);\n\n    if (this._filterInputNode) {\n      try {\n        this._filterInputNode.focus();\n        const val = this._filterInputNode.value || '';\n        this._filterInputNode.setSelectionRange(val.length, val.length);\n      } catch {\n        /* ignore browsers that prevent setSelectionRange */\n      }\n    }\n  }\n\n  protected _renderLabel(): TemplateResult {\n    const {\n      disabled,\n      inputLabel,\n      label,\n      open,\n      readOnly,\n      value,\n      _activeDescendant: activeDescendant,\n      _filterInputValue: filterInputValue,\n      _handleInput: handleInput,\n      _handleInputKeydown: handleInputKeydown,\n    } = this;\n\n    const inputClasses = classMap({\n      [`${prefix}--text-input`]: true,\n      [`${prefix}--text-input--empty`]: !value,\n    });\n\n    let activeDescendantFallback: string | undefined;\n    if (open && !activeDescendant) {\n      const constructor = this.constructor as typeof CDSDropdown;\n      const items = this.querySelectorAll(constructor.selectorItem);\n      activeDescendantFallback = items[0]?.id;\n    }\n\n    return html`\n      <input\n        id=\"trigger-button\"\n        class=\"${inputClasses}\"\n        ?disabled=${disabled}\n        placeholder=\"${label}\"\n        .value=${filterInputValue}\n        role=\"combobox\"\n        aria-label=\"${ifNonEmpty(inputLabel)}\"\n        aria-labelledby=\"dropdown-label\"\n        aria-controls=\"menu-body\"\n        aria-haspopup=\"listbox\"\n        aria-autocomplete=\"list\"\n        aria-expanded=\"${String(open)}\"\n        aria-activedescendant=\"${ifDefined(\n          open ? (activeDescendant ?? activeDescendantFallback) : ''\n        )}\"\n        ?readonly=${readOnly}\n        @input=${handleInput}\n        @keydown=${handleInputKeydown} />\n    `;\n  }\n\n  // eslint-disable-next-line   @typescript-eslint/no-invalid-void-type -- https://github.com/carbon-design-system/carbon/issues/20452\n  protected _renderFollowingLabel(): TemplateResult | void {\n    const { clearSelectionLabel, _filterInputValue: filterInputValue } = this;\n\n    if (filterInputValue.length != 0) {\n      this.setAttribute('isClosable', '');\n    } else {\n      this.removeAttribute('isClosable');\n    }\n\n    return filterInputValue.length === 0\n      ? undefined\n      : html`\n          <div\n            id=\"selection-button\"\n            role=\"button\"\n            class=\"${prefix}--list-box__selection\"\n            tabindex=\"0\"\n            title=\"${clearSelectionLabel}\">\n            ${iconLoader(Close16, { 'aria-label': clearSelectionLabel })}\n          </div>\n        `;\n  }\n\n  protected _renderTitleLabel(): TemplateResult {\n    const {\n      disabled,\n      hideLabel,\n      titleText,\n      _slotTitleTextNode: slotTitleTextNode,\n      _handleSlotchangeLabelText: handleSlotchangeLabelText,\n    } = this;\n\n    const labelClasses = classMap({\n      [`${prefix}--label`]: true,\n      [`${prefix}--label--disabled`]: disabled,\n      [`${prefix}--visually-hidden`]: hideLabel,\n    });\n\n    const hasTitleText =\n      titleText ||\n      (slotTitleTextNode && slotTitleTextNode.assignedNodes().length > 0);\n\n    return html`\n      <label\n        id=\"dropdown-label\"\n        part=\"title-text\"\n        class=\"${labelClasses}\"\n        ?hidden=\"${!hasTitleText}\">\n        <slot name=\"title-text\" @slotchange=\"${handleSlotchangeLabelText}\"\n          >${titleText}</slot\n        >\n      </label>\n    `;\n  }\n  /**\n   * The `aria-label` attribute for the icon to clear selection.\n   */\n  @property({ attribute: 'clear-selection-label' })\n  clearSelectionLabel = 'Clear selection';\n\n  /**\n   * The `aria-label` attribute for the `<input>` for filtering.\n   */\n  @property({ attribute: 'input-label' })\n  inputLabel = '';\n\n  /**\n   * The custom item matching callback.\n   */\n  @property({ attribute: false })\n  itemMatches!: (item: CDSComboBoxItem, queryText: string) => boolean;\n\n  /**\n   * Provide custom filtering behavior.\n   */\n  @property({\n    attribute: 'should-filter-item',\n    converter: {\n      fromAttribute: (value) => value !== null,\n    },\n  })\n  shouldFilterItem: boolean | ShouldFilterItem = false;\n\n  shouldUpdate(changedProperties) {\n    super.shouldUpdate(changedProperties);\n    const { _selectedItemContent: selectedItemContent } = this;\n    if (selectedItemContent && changedProperties.has('value')) {\n      const selectedText = selectedItemContent?.textContent || '';\n      if (!this._filterInputValue || this._filterInputValue === selectedText) {\n        this._filterInputValue = selectedText;\n      }\n    }\n    return true;\n  }\n\n  protected _clearInputWithoutSelecting(focus = true) {\n    this._filterInputValue = '';\n    if (this._filterInputNode) {\n      this._filterInputNode.value = '';\n\n      if (focus) {\n        try {\n          this._filterInputNode.focus();\n          this._filterInputNode.setSelectionRange(0, 0);\n        } catch {\n          /* ignore */\n        }\n      }\n    }\n\n    this._resetFilteredItems();\n    this.removeAttribute('isClosable');\n    this.requestUpdate();\n  }\n\n  updated(changedProperties) {\n    super.updated(changedProperties);\n    if (changedProperties.has('open')) {\n      if (this.open && this._filterInputNode) {\n        this._handleInput();\n      } else if (!this.open) {\n        this._resetFilteredItems();\n\n        if (this.value) {\n          this._revertInputToSelected(false);\n          if (\n            this._filterInputNode &&\n            document.activeElement === this._filterInputNode\n          ) {\n            (this._filterInputNode as HTMLInputElement).blur();\n          }\n        } else if (\n          this._filterInputValue &&\n          this._filterInputValue.length > 0\n        ) {\n          this._clearInputWithoutSelecting(false);\n          if (\n            this._filterInputNode &&\n            document.activeElement === this._filterInputNode\n          ) {\n            (this._filterInputNode as HTMLInputElement).blur();\n          }\n        } else {\n          // nothing typed and no selection, ensure no extra changes\n        }\n      }\n    }\n    const { _listBoxNode: listBoxNode } = this;\n    if (listBoxNode) {\n      listBoxNode.classList.add(`${prefix}--combo-box`);\n    }\n  }\n\n  // Restores the full list when the query is cleared or the menu closes.\n  protected _resetFilteredItems() {\n    const items = this.querySelectorAll(\n      (this.constructor as typeof CDSComboBox).selectorItem\n    );\n    forEach(items, (item) => {\n      const comboItem = item as CDSComboBoxItem;\n      (comboItem as HTMLElement).style.display = '';\n      comboItem.highlighted = false;\n    });\n  }\n\n  // For combo box, open/selection with space key is disabled given the input box should take it over\n  static TRIGGER_KEYS = new Set(['Enter']);\n\n  /**\n   * A selector that will return highlighted items.\n   */\n  static get selectorItemHighlighted() {\n    return `${prefix}-combo-box-item[highlighted]`;\n  }\n\n  /**\n   * A selector that will return combo box items.\n   */\n  static get selectorItem() {\n    return `${prefix}-combo-box-item`;\n  }\n\n  /**\n   * A selector that will return selected items.\n   */\n  static get selectorItemSelected() {\n    return `${prefix}-combo-box-item[selected]`;\n  }\n\n  /**\n   * The name of the custom event fired before this combo box item is being toggled upon a user gesture.\n   * Cancellation of this event stops the user-initiated action of toggling this combo box item.\n   */\n  static get eventBeforeToggle() {\n    return `${prefix}-combo-box-beingtoggled`;\n  }\n\n  /**\n   * The name of the custom event fired after this combo box item is toggled upon a user gesture.\n   */\n  static get eventToggle() {\n    return `${prefix}-combo-box-toggled`;\n  }\n\n  /**\n   * The name of the custom event fired before a combo box item is selected upon a user gesture.\n   * Cancellation of this event stops changing the user-initiated selection.\n   */\n  static get eventBeforeSelect() {\n    return `${prefix}-combo-box-beingselected`;\n  }\n\n  /**\n   * The name of the custom event fired after a a combo box item is selected upon a user gesture.\n   */\n  static get eventSelect() {\n    return `${prefix}-combo-box-selected`;\n  }\n\n  static styles = styles;\n}\n\nexport default CDSComboBox;\n"],"names":["customElement"],"mappings":"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"}